<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Crypto Trading Portfolio Dashboard</title>\n    <script src=\"https://cdn.plot.ly/plotly-latest.min.js\"></script>\n    <script src=\"https://code.jquery.com/jquery-3.6.0.min.js\"></script>\n    <link href=\"https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css\" rel=\"stylesheet\">\n    <link href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css\" rel=\"stylesheet\">\n    <style>\n        .metric-card {\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            border-radius: 10px;\n            padding: 20px;\n            margin-bottom: 20px;\n        }\n        .alert-badge {\n            position: absolute;\n            top: -5px;\n            right: -5px;\n        }\n        .portfolio-card {\n            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n            border-radius: 10px;\n            margin-bottom: 20px;\n        }\n        .positive { color: #28a745; }\n        .negative { color: #dc3545; }\n        .chart-container {\n            background: white;\n            border-radius: 10px;\n            padding: 20px;\n            box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        }\n    </style>\n</head>\n<body class=\"bg-light\">\n    <nav class=\"navbar navbar-dark bg-dark\">\n        <div class=\"container-fluid\">\n            <span class=\"navbar-brand mb-0 h1\">\n                <i class=\"fas fa-chart-line\"></i> Crypto Trading Portfolio Dashboard\n            </span>\n            <div class=\"position-relative\">\n                <button class=\"btn btn-outline-light\" id=\"alertsBtn\">\n                    <i class=\"fas fa-bell\"></i> Alerts\n                    <span class=\"badge bg-danger alert-badge\" id=\"alertCount\">0</span>\n                </button>\n            </div>\n        </div>\n    </nav>\n\n    <div class=\"container-fluid mt-4\">\n        <!-- Overview Row -->\n        <div class=\"row\">\n            <div class=\"col-md-3\">\n                <div class=\"metric-card\">\n                    <h6><i class=\"fas fa-wallet\"></i> Portfolio Value</h6>\n                    <h3 id=\"totalValue\">$0</h3>\n                    <small id=\"totalReturn\" class=\"text-light\">0.00%</small>\n                </div>\n            </div>\n            <div class=\"col-md-3\">\n                <div class=\"metric-card\">\n                    <h6><i class=\"fas fa-chart-line\"></i> Total P&L</h6>\n                    <h3 id=\"totalPnl\">$0</h3>\n                    <small id=\"winRate\" class=\"text-light\">Win Rate: 0%</small>\n                </div>\n            </div>\n            <div class=\"col-md-3\">\n                <div class=\"metric-card\">\n                    <h6><i class=\"fas fa-exclamation-triangle\"></i> Risk Score</h6>\n                    <h3 id=\"riskScore\">0</h3>\n                    <small id=\"drawdown\" class=\"text-light\">Drawdown: 0%</small>\n                </div>\n            </div>\n            <div class=\"col-md-3\">\n                <div class=\"metric-card\">\n                    <h6><i class=\"fas fa-coins\"></i> Positions</h6>\n                    <h3 id=\"positionCount\">0</h3>\n                    <small id=\"sharpeRatio\" class=\"text-light\">Sharpe: 0.00</small>\n                </div>\n            </div>\n        </div>\n\n        <!-- Charts Row -->\n        <div class=\"row\">\n            <div class=\"col-md-8\">\n                <div class=\"chart-container\">\n                    <h5><i class=\"fas fa-chart-area\"></i> Portfolio P&L</h5>\n                    <div id=\"pnlChart\"></div>\n                </div>\n            </div>\n            <div class=\"col-md-4\">\n                <div class=\"chart-container\">\n                    <h5><i class=\"fas fa-pie-chart\"></i> Asset Allocation</h5>\n                    <div id=\"allocationChart\"></div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Positions and Alerts Row -->\n        <div class=\"row\">\n            <div class=\"col-md-8\">\n                <div class=\"portfolio-card card\">\n                    <div class=\"card-header\">\n                        <h5><i class=\"fas fa-list\"></i> Current Positions</h5>\n                    </div>\n                    <div class=\"card-body\">\n                        <div class=\"table-responsive\">\n                            <table class=\"table table-hover\" id=\"positionsTable\">\n                                <thead>\n                                    <tr>\n                                        <th>Symbol</th>\n                                        <th>Side</th>\n                                        <th>Size</th>\n                                        <th>Entry Price</th>\n                                        <th>Current Price</th>\n                                        <th>P&L</th>\n                                        <th>Weight</th>\n                                    </tr>\n                                </thead>\n                                <tbody></tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class=\"col-md-4\">\n                <div class=\"portfolio-card card\">\n                    <div class=\"card-header\">\n                        <h5><i class=\"fas fa-exclamation-circle\"></i> Recent Alerts</h5>\n                    </div>\n                    <div class=\"card-body\" id=\"alertsList\" style=\"max-height: 400px; overflow-y: auto;\">\n                        <!-- Alerts will be loaded here -->\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Rebalancing Recommendations -->\n        <div class=\"row\">\n            <div class=\"col-12\">\n                <div class=\"portfolio-card card\">\n                    <div class=\"card-header\">\n                        <h5><i class=\"fas fa-balance-scale\"></i> Rebalancing Recommendations</h5>\n                    </div>\n                    <div class=\"card-body\">\n                        <div class=\"table-responsive\">\n                            <table class=\"table table-hover\" id=\"rebalancingTable\">\n                                <thead>\n                                    <tr>\n                                        <th>Symbol</th>\n                                        <th>Current Weight</th>\n                                        <th>Target Weight</th>\n                                        <th>Deviation</th>\n                                        <th>Action</th>\n                                        <th>Urgency</th>\n                                        <th>Reason</th>\n                                    </tr>\n                                </thead>\n                                <tbody></tbody>\n                            </table>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <script>\n        // Dashboard JavaScript functions\n        function formatCurrency(value) {\n            return new Intl.NumberFormat('en-US', {\n                style: 'currency',\n                currency: 'USD'\n            }).format(value);\n        }\n\n        function formatPercentage(value) {\n            return (value * 100).toFixed(2) + '%';\n        }\n\n        function loadPortfolioOverview() {\n            $.get('/api/portfolio/overview', function(data) {\n                if (data.error) {\n                    console.error(data.error);\n                    return;\n                }\n\n                $('#totalValue').text(formatCurrency(data.total_value));\n                $('#totalPnl').text(formatCurrency(data.total_pnl));\n                $('#totalReturn').text(data.total_return_pct.toFixed(2) + '%');\n                $('#positionCount').text(data.position_count);\n\n                // Update positions table\n                const tbody = $('#positionsTable tbody');\n                tbody.empty();\n\n                data.positions.forEach(function(pos) {\n                    const row = `\n                        <tr>\n                            <td><strong>${pos.symbol}</strong></td>\n                            <td><span class=\"badge ${pos.side === 'long' ? 'bg-success' : 'bg-danger'}\">${pos.side.toUpperCase()}</span></td>\n                            <td>${pos.size.toFixed(4)}</td>\n                            <td>${formatCurrency(pos.entry_price)}</td>\n                            <td>${formatCurrency(pos.current_price)}</td>\n                            <td class=\"${pos.pnl >= 0 ? 'positive' : 'negative'}\">\n                                ${formatCurrency(pos.pnl)}<br>\n                                <small>(${pos.pnl_pct.toFixed(2)}%)</small>\n                            </td>\n                            <td>${formatPercentage(pos.weight)}</td>\n                        </tr>\n                    `;\n                    tbody.append(row);\n                });\n            });\n        }\n\n        // Load all data on page load\n        $(document).ready(function() {\n            loadPortfolioOverview();\n            \n            // Refresh data every 30 seconds\n            setInterval(function() {\n                loadPortfolioOverview();\n            }, 30000);\n        });\n    </script>\n</body>\n</html>